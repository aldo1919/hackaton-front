<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBVA</title>
    <link rel="stylesheet" href="./css/nav.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
</head>
<body>
    <div id="root">
        <nav class="container-fluid navbar navbar-expand-lg home-nav-fluid">
           <div class="container home-nav-container">
               <a class="navbar-brand" href="#">
                   <img class="home-nav-img" src="./images/logo_bbva_blanco.svg">
               </a>

               <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                   <span class="navbar-toggler-icon"></span>
               </button>

               <div class="collapse navbar-collapse home-nav-sections" id="navbarSupportedContent">
                   <ul class="navbar-nav me-auto mb-2 mb-lg-0 home-nav-list">
                       <li class="nav-item home-nav-item active">
                           <a class="nav-link home-nav-link active" aria-current="page" href="#">PERSONAS</a>
                       </li>
                       <li class="nav-item home-nav-item">
                           <a class="nav-link home-nav-link" href="#">EMPRESAS</a>
                       </li>
                   </ul>
                   <ul class="navbar-nav me-auto mb-2 mb-lg-0 home-nav-list">
                       <li class="nav-item home-nav-card-item">
                           <a class="nav-link home-nav-card" href="#">
                               <svg class="home-nav-icon home-nav-card-icon" xmlns="http://www.w3.org/2000/svg" id="b3c87a6d-227a-4cac-b89f-b132176f6014" data-name="Blue" viewBox="0 0 260 260">
                                   <g id="ecc63e73-bfe2-4ff2-90ed-6d17caa880ef" data-name="Card">
                                       <path id="edea3f2a-1e86-4f8b-8f9c-fc6bc7acd140" data-name="Icon" class="a3ab023b-8dfa-40ed-8237-c194aa9925a4" d="M10,107.5H184.55L206.36,85H10V51.26A11,11,0,0,1,20.94,40H239.06A11.08,11.08,0,0,1,250,51.26V208.74A11,11,0,0,1,239.06,220H20.94A11.08,11.08,0,0,1,10,208.74Zm141.82,56.25v22.5h43.63l21.82-22.5Z"/>
                                   </g>
                               </svg>
                               <span>Obten tu Tarjeta de Credito</span>
                           </a>
                       </li>
                       <span class="break--height-line"></span>
                       <li class="nav-item home-nav-card-item">
                           <a class="nav-link home-nav-card active" href="#">
                               <img class="home-nav-icon" src="./images/savings.svg">
                               <span>Abre tu cuenta</span>
                           </a>
                       </li>
                   </ul>
                   <div class="home-button-container">
                       <button class="btn btn-lg home-button">
                           Banca por Internet
                       </button>
                   </div>
                   <div class="home-search-container">
                       <svg class="home-nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 260 260" height="20px" width="20px">
                           <path class="bbvaicn" d="M182.85 162.85a90 90 0 1 0-20 20L220 240l20-20zM150 110a40 40 0 0 0-40-40V50a60 60 0 0 1 60 60z"></path>
                       </svg>
                   </div>
                   <div class="home-nav-menu">
                       <span>Menu</span>
                       <svg class="home-nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 260 260" height="24px" width="24px">
                           <g>
                               <polygon class="bbvaicn" points="210.37 80.12 20.37 80.12 20.37 50.12 240.37 50.12 210.37 80.12"></polygon>
                               <polygon class="bbvaicn" points="180.37 145.12 20.37 145.12 20.37 115.12 210.37 115.12 180.37 145.12"></polygon>
                               <polygon class="bbvaicn" points="150.37 210.12 20.37 210.12 20.37 180.12 180.37 180.12 150.37 210.12"></polygon>
                           </g>
                       </svg>
                   </div>
               </div>
           </div>
       </nav>
   </div>
    <div class="section">
        <div class="col-md-6">
            <div class="my-6">
                <input type="text" id="search-map" style="width: 400px;margin-bottom:10px">
            </div>
            <div style="position: relative;">
                <div id="loader-custom" class="loader-custom d-none">
                    <div class="spinner-border" role="status" >
                    </div>
                </div>  
                <div id="map" style="width: auto; height: 500px;"></div>
                <div  class="d-flex justify-content-center">
                    <div class="d-flex justify-center align-items-center">
                        <span>Vacio</span> <div class="pl-2" style="margin-left: 0.2rem;height: 1rem; width:1rem;background-color: green;"></div>
                    </div>
                    <div class="d-flex justify-center align-items-center  mx-2">
                        <span>Semi Lleno</span> <div class="pl-2" style="margin-left: 0.2rem;height: 1rem; width:1rem;background-color: yellow;"></div>
                    </div>
                    <div class="d-flex justify-center align-items-center  mx-2">
                        <span>Lleno</span> <div class="pl-2" style="margin-left: 0.2rem;height: 1rem; width:1rem;background-color: red;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let  map;
        let marker;
        let infoWindow;
        const markers = [
            {lat:-12.0925634,lng: -77.0203588,quantity:10,color:'yellow'},
            {lat:-12.0972407 ,lng: -77.0224126,quantity:40,color:'red'},
            {lat:-12.092057 ,lng: -77.018868,quantity:60,color:'green'},
        ];
        function iniciarMap(){
                var coord = {lat:-12.0529046 ,lng: -77.0253457};
                map = new google.maps.Map(document.getElementById('map'),{
                    zoom: 10,
                    center: coord
                });
                marker = new google.maps.Marker({
                    position: coord,
                    map: map,
                });
                // icon: './img/bbva.png',
                const searchMap = document.getElementById('search-map');
                const autocomplete = new google.maps.places.Autocomplete(searchMap);
                // autocomplete.bindTo('bounds',map);
                autocomplete.addListener("place_changed",()=>{
                    const place = autocomplete.getPlace();
                    const {geometry:{viewport,location}} = place;
                    map.setCenter(location);
                    map.setZoom(16);
                    addInfoMap(location);
                })
                //Buscar código postal
        }
        var code_postal;
        async function searchPostalCode(coord){
            geocoder = new google.maps.Geocoder();
            
            let data ={
                // country:'País no encontrada',
                // city:'Ciudad no encontrada',
                address:'Dirección no encontrada.',
                // postal_code:'Código Postal no encontrada'
            }
            const {results} =await geocoder.geocode({'latLng': coord}, ()=>{});
            if (results[0]) {
                data.address =results[0].formatted_address;
                // for (j = 0; j < results[0].address_components.length; j++) {
                //     if (results[0].address_components[j].types[0] == 'postal_code'){
                //         data.postal_code = results[0].address_components[j].short_name;
                //     }
                //     if (results[0].address_components[j].types[0] == "country") {
                //         data.country = results[0].address_components[j].long_name;
                //     }
                //     if (results[0].address_components[j].types[0] == "locality") {
                //         data.city = results[0].address_components[j].long_name;
                //     }
                // }
            }
            return data;
        }
        setCurrentPositionMap();
        function setCurrentPositionMap(){
            // e.preventDefault();
            // searchCurrentLocation.disabled = true;
            let loader = document.getElementById("loader-custom");
                loader.classList.remove("d-none");
                if ("geolocation" in navigator){
                navigator.geolocation.getCurrentPosition(function(position){ 
                    var currentLatitude = position.coords.latitude;
                    var currentLongitude = position.coords.longitude;
                    var currentLocation = { lat: currentLatitude, lng: currentLongitude };
                    // marker.setPosition(currentLocation);
                    // marker = new google.maps.Marker({
                    //     position: currentLocation,
                    //     map: map,
                    // });
                    markers.forEach(marker => {
                        let location_marker = {
                            lat:marker.lat,
                            lng:marker.lng
                        };
                        const marker_google =new google.maps.Marker({
                            position: location_marker,
                            icon:`./img/marker-${marker.color}.svg`,
                            map: map,
                        })
                        
                        let fn = infoFn(location_marker,marker);
                        google.maps.event.addListener(marker_google, 'click', fn);
                    });
                    map.setCenter(currentLocation);
                    map.setZoom(16);
                });
                loader.classList.add("d-none");
            }
        }
        let infoFn = function (currentLocation,marker) {
            return async function (e) {
                if(infoWindow){
                    infoWindow.close();
                }
                const {address} =await searchPostalCode(currentLocation);
                var content = `<div>Dirección: ${address}</div><br><div>Afluencia: ${marker.quantity} personas</div>`;
                infoWindow = new google.maps.InfoWindow({map: map, content: content});
                infoWindow.setPosition(currentLocation);
            }
        };
        // async function addInfoMap(currentLocation){
        //     //Setear información en el mapa
        //     const {address} =await searchPostalCode(currentLocation);
        //     var infoWindowHTML = `Dirección: ${address}`;
        //     var infoWindow = new google.maps.InfoWindow({map: map, content: infoWindowHTML});
        //     infoWindow.setPosition(currentLocation);
        //     //Setear información en los inputs
        // }
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDLM2ylauTXO0yLFGOYGRwRUIYNucn4EWc&callback=iniciarMap&libraries=places"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
</body>
</html>